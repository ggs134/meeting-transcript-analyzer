"""
MongoDB에 샘플 회의 Transcript 데이터를 삽입하는 스크립트
"""

from pymongo import MongoClient
from datetime import datetime, timedelta
import os


def insert_sample_transcripts():
    """샘플 회의 transcript 데이터를 MongoDB에 삽입"""
    
    # MongoDB 연결
    MONGODB_URI = os.getenv('MONGODB_URI', 'mongodb://localhost:27017/')
    DATABASE_NAME = os.getenv('DATABASE_NAME', 'company_db')
    COLLECTION_NAME = os.getenv('COLLECTION_NAME', 'meeting_transcripts')
    
    client = MongoClient(MONGODB_URI)
    db = client[DATABASE_NAME]
    collection = db[COLLECTION_NAME]
    
    # 기존 데이터 삭제 (선택사항)
    # collection.delete_many({})
    
    # 샘플 회의 transcript 데이터
    sample_transcripts = [
        {
            "title": "Q4 제품 개발 전략 회의",
            "date": datetime.now() - timedelta(days=7),
            "transcript": """[00:00:15] 김민수: 좋습니다, 모두들 참석해주셔서 감사합니다. 오늘은 Q4 제품 개발 로드맵에 대해 논의하겠습니다. 먼저 제가 전체적인 일정과 주요 마일스톤을 공유드리겠습니다.
[00:00:45] 김민수: 우리의 최우선 목표는 11월 말까지 AI 챗봇 기능을 출시하는 것입니다. 시장 조사 결과 경쟁사들이 이미 유사한 기능을 준비하고 있어서 빠른 출시가 중요합니다.
[00:01:20] 이지은: 네, 동의합니다. 제가 기술적인 부분을 설명드리겠습니다. AI 챗봇 구현을 위해서는 먼저 데이터 학습 파이프라인을 구축해야 합니다.
[00:01:45] 이지은: 예상 소요 시간은 약 4주입니다. GPT-4 API를 활용하되 우리만의 fine-tuning 데이터셋을 준비할 필요가 있습니다. 고객 문의 데이터 1만 건 정도를 학습시키면 충분할 것 같습니다.
[00:02:30] 박준호: 좋은 계획입니다. 그런데 백엔드 성능 이슈는 어떻게 해결할까요? 현재 API 응답 속도가 느린 편인데 AI 기능이 추가되면 더 느려질 수 있습니다.
[00:03:00] 박준호: 제 제안은 캐싱 시스템을 도입하고 데이터베이스 쿼리를 최적화하는 것입니다. 이렇게 하면 API 응답 시간을 최소 50% 단축할 수 있습니다.
[00:03:25] 이지은: 좋은 지적입니다. 성능 최적화는 병행해서 진행하면 좋겠습니다. Redis 캐시를 도입하는 건 어떨까요?
[00:03:40] 박준호: 네, Redis가 가장 적합할 것 같습니다. 이번 주 안에 프로토타입을 만들어서 테스트해보겠습니다.
[00:04:10] 최서연: 마케팅 관점에서 한 가지 제안 드리겠습니다. 베타 테스트를 통해 초기 사용자 피드백을 받는 것이 중요합니다.
[00:04:35] 최서연: 11월 첫째 주에 베타 테스터 100명을 모집해서 2주간 테스트를 진행하면 어떨까요? 그들의 피드백을 바탕으로 정식 출시 전에 개선할 수 있습니다.
[00:05:00] 김민수: 좋은 아이디어입니다. 그렇다면 개발 일정을 조정해야겠네요. 이지은님, 10월 25일까지 베타 버전을 준비할 수 있을까요?
[00:05:20] 이지은: 네, 가능합니다. 핵심 기능에 집중하고 UI는 간소화하면 일정 내에 맞출 수 있습니다.
[00:05:45] 김민수: 완벽합니다. 그럼 정리하겠습니다. 이지은님은 AI 모델 학습 데이터셋 준비를 25일까지, 박준호님은 API 성능 테스트를 23일까지 완료해주세요.
[00:06:15] 김민수: 최서연님은 베타 테스터 모집 캠페인 기획안을 22일까지 작성해주시고, 저는 전체 개발 일정을 세부적으로 수립해서 21일까지 공유하겠습니다.
[00:06:40] 최서연: 네, 알겠습니다. 베타 테스터에게 제공할 인센티브도 함께 기획하겠습니다.
[00:06:55] 박준호: 확인했습니다. 성능 벤치마크 결과도 함께 공유하겠습니다.
[00:07:10] 이지은: 저도 준비하겠습니다. 데이터셋 샘플을 먼저 공유드릴게요.
[00:07:25] 김민수: 감사합니다. 매주 금요일 오후 3시에 진행 상황 공유 회의를 진행하겠습니다. 오늘 회의는 여기서 마치겠습니다."""
        },
        {
            "title": "마케팅 캠페인 결과 분석 회의",
            "date": datetime.now() - timedelta(days=3),
            "transcript": """[00:00:10] 최서연: 안녕하세요, 오늘은 지난 달 진행된 SNS 마케팅 캠페인 성과를 공유드리겠습니다.
[00:00:30] 최서연: 전체적으로 매우 긍정적인 결과를 얻었습니다. 투자 대비 수익률 ROI가 125%를 달성했고, 신규 가입자는 전월 대비 85% 증가했습니다.
[00:01:00] 정민재: 정말 좋은 성과네요! 채널별로 보면 어떤가요?
[00:01:15] 최서연: 네, 채널별 분석 결과를 말씀드리겠습니다. 인스타그램에서 가장 높은 참여율을 기록했습니다. 특히 릴스 콘텐츠의 조회수가 평균 50만을 넘었습니다.
[00:01:45] 정민재: 제가 릴스 콘텐츠를 주로 담당했는데요, 짧고 임팩트 있는 영상이 효과적이었던 것 같습니다. 특히 제품 사용 팁을 15초로 압축한 영상들이 가장 많이 공유됐습니다.
[00:02:20] 강혜진: 타겟 고객층 분석 결과를 보면 20-30대 여성 고객 비중이 60%입니다. 이들은 주로 저녁 7-9시 사이에 가장 활발하게 활동합니다.
[00:02:50] 강혜진: 그리고 흥미로운 점은 이들이 제품 구매 전에 평균 5-7개의 게시물을 본다는 거예요. 지속적인 콘텐츠 노출이 중요하다는 걸 알 수 있습니다.
[00:03:20] 최서연: 좋은 인사이트입니다. 이를 바탕으로 다음 캠페인 전략을 제안하겠습니다. 첫째, 인스타그램 릴스 콘텐츠 제작을 주 2회로 늘립니다.
[00:03:45] 최서연: 둘째, 유튜브 숏츠 채널을 신규로 개설합니다. 유튜브는 아직 본격적으로 활용하지 못했는데 숏츠 형태로 접근하면 시너지 효과를 낼 수 있을 것 같습니다.
[00:04:10] 정민재: 유튜브 숏츠 좋습니다! 인스타그램 콘텐츠를 재활용할 수도 있고요. 제가 콘텐츠 제작 일정표를 작성해서 24일까지 공유하겠습니다.
[00:04:35] 강혜진: 유튜브 채널 개설은 제가 맡겠습니다. 초기 콘텐츠 10개 정도를 기획해서 26일까지 준비하겠습니다.
[00:05:00] 최서연: 감사합니다. 그리고 인플루언서 협업도 확대하고 싶습니다. 예산을 30% 증액해서 마이크로 인플루언서 5-10명과 협업하는 것이 어떨까요?
[00:05:30] 정민재: 좋은 생각입니다. 대형 인플루언서 한 명보다 마이크로 인플루언서 여러 명이 더 효과적일 수 있습니다. 진정성 있는 리뷰를 얻을 수 있으니까요.
[00:05:50] 강혜진: 동의합니다. 특히 우리 타겟층과 맞는 라이프스타일 인플루언서들이 좋을 것 같습니다.
[00:06:15] 최서연: 완벽합니다. 그럼 제가 인플루언서 후보 리스트를 작성하고 협업 제안서를 25일까지 발송하겠습니다. 다들 수고하셨습니다!
[00:06:30] 정민재: 감사합니다!
[00:06:35] 강혜진: 수고하셨습니다!"""
        },
        {
            "title": "고객 서비스 개선 방안 논의",
            "date": datetime.now() - timedelta(days=1),
            "transcript": """[00:00:05] 박준호: 회의 시작하겠습니다. 최근 고객 문의가 급증하면서 응답 시간이 늘어나고 있는 상황입니다.
[00:00:25] 박준호: 데이터를 보면 평균 응답 시간이 24시간에서 48시간으로 증가했습니다. 이는 고객 만족도에 직접적인 영향을 미치고 있습니다.
[00:00:50] 윤지호: 네, 맞습니다. 고객 서비스 팀 입장에서 말씀드리면 인력 부족이 가장 큰 문제입니다. 현재 4명이서 하루 평균 120건의 문의를 처리하고 있는데 벅찹니다.
[00:01:20] 윤지호: 특히 같은 질문이 반복되는 경우가 많습니다. 배송, 환불, 사용법 관련 문의가 전체의 70%를 차지합니다.
[00:01:50] 이지은: 그렇다면 AI 챗봇 도입이 해결책이 될 수 있을 것 같습니다. 자주 묻는 질문에 대해서는 챗봇이 자동으로 응답하고, 복잡한 문의만 상담원에게 연결하면 됩니다.
[00:02:20] 이지은: 제품 개발 회의에서 이미 AI 챗봇 개발을 결정했으니, 고객 서비스용 기능을 우선순위로 개발하면 좋겠습니다.
[00:02:45] 김민수: 좋은 제안입니다. 개발 로드맵에 바로 반영하겠습니다. 단기적으로는 어떻게 대응하면 좋을까요?
[00:03:05] 박준호: 단기 대응으로는 FAQ 페이지를 대폭 개선하는 것을 제안합니다. 현재 FAQ가 20개 항목밖에 없는데, 50개 이상으로 확대하고 검색 기능도 추가하면 자체 해결률을 높일 수 있습니다.
[00:03:35] 윤지호: 제가 고객 문의 데이터를 분석해서 상위 10개 질문을 정리하겠습니다. 이걸 바탕으로 FAQ를 확장하면 좋을 것 같습니다.
[00:04:00] 박준호: 완벽합니다. 저는 FAQ 페이지 콘텐츠를 업데이트하고 검색 기능을 추가하는 작업을 21일까지 완료하겠습니다.
[00:04:25] 김민수: 그리고 근본적으로는 인력 충원도 필요합니다. HR팀과 협의해서 2명을 추가로 채용하도록 하겠습니다.
[00:04:50] 윤지호: 감사합니다. 그렇게 되면 응답 시간을 24시간 이내로 단축할 수 있을 것 같습니다.
[00:05:15] 이지은: 챗봇 관련해서 제가 응답 시나리오 초안을 25일까지 작성하겠습니다. 윤지호님이 정리해주시는 상위 질문들을 참고하겠습니다.
[00:05:40] 윤지호: 네, 제가 22일까지 데이터 분석 결과를 공유드리겠습니다. 실제 고객 문의 케이스도 함께 첨부하겠습니다.
[00:06:00] 김민수: 좋습니다. 그럼 정리하겠습니다. 박준호님은 FAQ 페이지 업데이트를 21일까지, 윤지호님은 고객 문의 분석을 22일까지, 이지은님은 챗봇 시나리오를 25일까지 완료해주세요.
[00:06:30] 김민수: 저는 HR팀과 인력 충원 계획을 협의해서 23일까지 공유하겠습니다. 모두 수고하셨습니다.
[00:06:45] 박준호: 감사합니다!
[00:06:48] 윤지호: 수고하셨습니다!
[00:06:51] 이지은: 감사합니다!"""
        }
    ]
    
    # 데이터 삽입
    result = collection.insert_many(sample_transcripts)
    print(f"✅ {len(result.inserted_ids)}개의 샘플 회의 transcript를 삽입했습니다.")
    
    # 삽입된 문서 확인
    print("\n📋 삽입된 회의 transcript 목록:")
    for meeting in collection.find():
        print(f"  - {meeting['title']} ({meeting['date'].strftime('%Y-%m-%d')})")
        # Transcript 첫 100자 미리보기
        transcript_preview = meeting['transcript'][:100].replace('\n', ' ')
        print(f"    미리보기: {transcript_preview}...")
    
    client.close()


if __name__ == "__main__":
    insert_sample_transcripts()
